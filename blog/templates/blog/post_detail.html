{% extends "base.html" %}

{% block page_title %}
<div class="text-center my-5">
    <h1 class="display-4 fw-bold" style="color: #73BDAB;">{{ post.title }}</h1>
</div>
{% endblock page_title %}

{% block content %}
<div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 mb-4">
        <!-- TOC -->
        {% comment %} <div class="card mb-4 shadow-sm">
            <div class="card-header" style="background-color:#CC6B49; color:#fff; font-weight:600;">
                Table of Contents
            </div>
            <div id="toc" class="p-3 bg-light border rounded">No Table of Contents available</div>
        </div> {% endcomment %}


   <div class="card mb-4 shadow-sm">
    <div class="card-header" style="background-color:#CC6B49; color:#fff; font-weight:600;">
        Table of Contents
    </div>
    <div id="toc" class="p-3 bg-light border rounded" style="background-color: #F5F0E6 !important;">
        {% if toc_headings %}
            <ul class="mb-0" style="list-style-type:none; padding-left:0;">
                {% for h in toc_headings %}
                    <li style="padding-left:{% if h.level == 'h3' %}25px{% else %}0{% endif %}; line-height:1.4; margin-bottom:4px; display:flex; align-items:top;">
                        <span style="color:#CC6B49; font-size:0.8em; margin-right:8px;">
                            {% if h.level == 'h2' %}●{% else %}○{% endif %}
                        </span>
                        <a href="#{{ h.id }}" style="text-decoration:none; color:#6F5643; transition:all 0.2s;">
                            {{ h.text }}
                        </a>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-muted mb-0" >No Table of Contents available.</p>
        {% endif %}
    </div>
</div> 

        <!-- Posts -->
        <div class="card my-4 shadow-sm">
            <div class="card-header" style="background-color:#948c3c; color:#fff; font-weight:600;">
                Post Links
            </div>
            <ul class="list-group list-group-flush">

                     {% for link in post.links.all %}
                        <li class="list-group-item" style="color: #6F5643;background-color: #F5F0E6;">
                            <strong>{{ link.get_link_type_display }}:</strong>
                            <a href="{{ link.url }}" target="_blank" rel="noopener">{{ link.title }}</a>
                        </li>
                        {% empty %}
                        <li class="list-group-item text-muted">No Post Links Yet.</li>
                        {% endfor %}




            </ul>
        </div>

    </div>

    <!-- Main Post -->
    <div class="col-md-9">
        <div class="card shadow-sm border-0 mb-4" >
          <img 
    src="{% if post.cover %}{{ post.cover.url }}{% else %}/static/images/default_post.png{% endif %}" 
    class="card-img-top" 
    alt="{{ post.cover_alt|default:post.title }}" 
    style="object-fit: cover; max-height: 600px;"
>



<!-- Improved H1 -->
<h1 class="post-title mx-3 mt-4">{{ post.title }}</h1>

           <div class="card-body">

                <!-- Categories always below -->
                <small class="text-muted d-block mb-3">
                    {{ post.created_at|date:"F j, Y" }} | Categories:
                    {% if post.categories.all %}
                        {% for category in post.categories.all %}
                            <a href="{% url 'post_category' category.slug %}" class="category-chip">{{ category.name }}</a>
                        {% endfor %}
                    {% else %}
                        <span class="text-muted">Uncategorized</span>
                    {% endif %}
                </small>




                <div class="card-text mt-3 post-body" style="color: #6F5643;">
                    {{ post.body|safe }}
                </div>
{% if post.tags.exists %}
    <div class="mt-3">
        <i class="bi bi-tags-fill me-1" style="color: #6F5643;"></i> 
        {% comment %} <strong>Tags:</strong> {% endcomment %}
        {% for tag in post.tags.all %}
            <a href="{% url 'post_tag' tag.slug %}" 
               class=" text-decoration-none me-1">
                #{{ tag.name }}
            </a>
        {% endfor %}
    </div>
{% endif %}




                {% if post.related_items.exists %}
                <div class="mt-4">
                    <h5>Related Posts & Tutorials:</h5>
                    <ul class="list-group list-group-flush">
                        {% for item in post.related_items.all %}
                            <li class="list-group-item">
                                <a href="{{ item.content_object.get_absolute_url }}">{{ item.content_object.title }}</a>
                                <small class="text-muted">({{ item.content_type.model }})</small>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>




        <a href="{% url 'post_index' %}" class="btn btn-primary mb-5">← Back to Posts</a>
    </div>
</div>




{% endblock content %}

