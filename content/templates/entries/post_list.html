{% extends "base.html" %}
{% block title %}Posts — My Blog{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-8">
    <h1 class="mb-4">Posts</h1>

    {% for post in posts %}
      <article class="mb-4 pb-3 border-bottom">
        <div class="row g-3">
          {% if post.cover %}
            <div class="col-4">
              <a href="{% url 'post_detail' slug=post.slug %}">
                <img src="{{ post.cover.url }}" alt="{{ post.cover_alt }}" class="img-fluid rounded cover-img">
              </a>
            </div>
            <div class="col-8">
          {% else %}
            <div class="col-12">
          {% endif %}
              <h2 class="h5 mb-1">
                <a href="{% url 'post_detail' slug=post.slug %}">{{ post.title }}</a>
              </h2>

              <div class="mb-2 text-muted small">
                {% if post.author %}By {{ post.author.get_full_name|default:post.author.username }} • {% endif %}
                {{ post.created_at|date:"M j, Y" }} • {{ post.reading_time }} min read
                {% if post.is_featured %} • <span class="badge bg-primary">Featured</span>{% endif %}
              </div>

              <p class="mb-1">{{ post.excerpt }}</p>

              <div class="small">
                {% for cat in post.categories.all %}
                  <a href="#" class="badge bg-light text-decoration-none">{{ cat.name }}</a>
                {% endfor %}
                {% for tag in post.tags.all %}
                  <a href="#" class="badge bg-secondary text-white text-decoration-none">{{ tag.name }}</a>
                {% endfor %}
              </div>
            </div>
        </div>
      </article>
    {% empty %}
      <p>No posts found.</p>
    {% endfor %}

    <!-- pagination -->
    <nav aria-label="Posts pagination">
      <ul class="pagination">
        {% if page_obj.has_previous %}
          <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a></li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Previous</span></li>
        {% endif %}

        {% for num in paginator.page_range %}
          {% if page_obj.number == num %}
            <li class="page-item active"><span class="page-link">{{ num }}</span></li>
          {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
          {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
          <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a></li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Next</span></li>
        {% endif %}
      </ul>
    </nav>
  </div>

  <aside class="col-md-4">
    <div class="mb-4">
      <h5>About</h5>
      <p class="small text-muted">A short blog about hardware, software and projects.</p>
    </div>

    <div class="mb-4">
      <h6>Recent</h6>
      <ul class="list-unstyled small">
        {% for r in posts|slice:":5" %}
          <li><a href="{% url 'post_detail' slug=r.slug %}">{{ r.title }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </aside>
</div>
{% endblock %}
