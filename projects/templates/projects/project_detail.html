{% extends "base.html" %}

{% block page_title %}
<div class="text-center my-5">
    <h1 class="display-4 fw-bold" style="color: #73BDAB;">{{ project.title }}</h1>
</div>
{% endblock page_title %}

{% block content %}
<div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 mb-4">
        <!-- TOC -->
        {% comment %} <div class="card mb-4 shadow-sm">
            <div class="card-header" style="background-color:#CC6B49; color:#fff; font-weight:600;">
                Table of Contents
            </div>
            <div id="toc" class="p-3 bg-light border rounded">No Table of Contents available</div>
        </div> {% endcomment %}


   <div class="card mb-4 shadow-sm">
    <div class="card-header" style="background-color:#CC6B49; color:#fff; font-weight:600;">
        Table of Contents
    </div>
    <div id="toc" class="p-3 bg-light border rounded" style="background-color: #F5F0E6 !important;">
        {% if toc_headings %}
            <ul class="mb-0" style="list-style-type:none; padding-left:0;">
                {% for h in toc_headings %}
                    <li style="padding-left:{% if h.level == 'h3' %}25px{% else %}0{% endif %}; line-height:1.4; margin-bottom:4px; display:flex; align-items:top;">
                        <span style="color:#CC6B49; font-size:0.8em; margin-right:8px;">
                            {% if h.level == 'h2' %}●{% else %}○{% endif %}
                        </span>
                        <a href="#{{ h.id }}" style="text-decoration:none; color:#6F5643; transition:all 0.2s;">
                            {{ h.text }}
                        </a>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-muted mb-0" >No Table of Contents available.</p>
        {% endif %}
    </div>
</div> 

        <!-- Projects -->
        <div class="card my-4 shadow-sm">
            <div class="card-header" style="background-color:#948c3c; color:#fff; font-weight:600;">
                Project Links
            </div>
            <ul class="list-group list-group-flush">

                     {% for link in project.links.all %}
                        <li class="list-group-item" style="color: #6F5643;background-color: #F5F0E6;">
                            <strong>{{ link.get_link_type_display }}:</strong>
                            <a href="{{ link.url }}" target="_blank" rel="noopener">{{ link.title }}</a>
                        </li>
                        {% empty %}
                        <li class="list-group-item text-muted">No Project Links Yet.</li>
                        {% endfor %}




            </ul>
        </div>

    </div>

    <!-- Main Post -->
    <div class="col-md-9">
        <div class="card shadow-sm border-0 mb-4" >
          <img 
    src="{% if project.cover %}{{ project.cover.url }}{% else %}/static/images/default_project.png{% endif %}" 
    class="card-img-top" 
    alt="{{ project.cover_alt|default:project.title }}" 
    style="object-fit: cover; max-height: 600px;"
>



<!-- Improved H1 -->
<h1 class="project-title mx-3 mt-4">{{ project.title }}</h1>

           <div class="card-body">
<small class="text-muted d-block mb-3">
    {{ project.created_at|date:"F j, Y" }} |
    {% if project.difficulty %}
        Difficulty: 
        <span class="badge" 
              style="
                  {% if project.difficulty == 'beginner' %}background-color: #73BDAB; color: #fff;
                  {% elif project.difficulty == 'intermediate' %}background-color: #CC6B49; color: #fff;
                  {% elif project.difficulty == 'advanced' %}background-color: #6F5643; color: #fff;
                  {% else %}background-color: #999; color: #fff;
                  {% endif %}
                  font-weight: 600;
              ">
            {{ project.get_difficulty_display }}
        </span>
    {% else %}
        Difficulty: 
        <span class="badge" style="background-color: #999; color: #fff; font-weight: 600;">N/A</span>
    {% endif %}
</small>



{% comment %} <div class="progress progress-tiny" style="position: relative; height: 25px;">
    <div class="progress-bar 
        {% if project.status == 'published' and project.progress_percent == 100 %} progress-filled
        {% elif project.status == 'in_progress' %} progress-partly
        {% elif project.status == 'draft' %} progress-empty
        {% else %} progress-empty
        {% endif %}"
        role="progressbar"
        style="width: 
            {% if project.status == 'published' and project.progress_percent == 100 %}100
            {% else %}{{ project.progress_percent }}
            {% endif %}%; position: relative;">
    </div>

    <span style="position: absolute; width: 100%; text-align: center; font-weight: 600; color: #6F5643; line-height: 25px;">
        {% if project.status == 'published' and project.progress_percent == 100 %}Completed
        {% elif project.status == 'in_progress' %}In Progress
        {% elif project.status == 'draft' %}Draft
        {% elif project.status == 'published' %}Published
        {% else %}Archived
        {% endif %}
    </span>
</div>  {% endcomment %}



       

                <div class="card-text mt-3 post-body" style="color: #6F5643;">
                    {{ project.body|safe }}
                </div>
{% if project.tags.exists %}
    <div class="mt-3">
        <i class="bi bi-tags-fill me-1" style="color: #6F5643;"></i> 
        {% comment %} <strong>Tags:</strong> {% endcomment %}
        {% for tag in project.tags.all %}
            <a href="{% url 'project_tag' tag.slug %}" 
               class=" text-decoration-none me-1">
                #{{ tag.name }}
            </a>
        {% endfor %}
    </div>
{% endif %}






                {% if project.related_items.exists %}
                <div class="mt-4">
                    <h5>Related Posts & Tutorials:</h5>
                    <ul class="list-group list-group-flush">
                        {% for item in project.related_items.all %}
                            <li class="list-group-item">
                                <a href="{{ item.content_object.get_absolute_url }}">{{ item.content_object.title }}</a>
                                <small class="text-muted">({{ item.content_type.model }})</small>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>

<h2>Required Materials</h2>
<ul style="list-style: none; padding: 0;">
  {% for entry_material in project.entrymaterial_set.all %}
    <li style="display: flex; align-items: center; margin-bottom: 12px;">
      {% if entry_material.material.icon %}
        <a href="{{ entry_material.material.url }}" target="_blank">
          <img src="{{ entry_material.material.icon.url }}" alt="{{ entry_material.material.name }}"
               style="width:80px; height:80px; object-fit:contain; margin-right:10px;">
        </a>
      {% endif %}
      <div>
        <strong>{{ entry_material.material.name }}</strong>
        {% if entry_material.quantity %} - {{ entry_material.quantity }}{% endif %}
        {% if entry_material.notes %} ({{ entry_material.notes }}){% endif %}
        {% if entry_material.url %}
          <br>
          <a href="{{ entry_material.material.url }}" target="_blank" style="color:#007BFF; text-decoration:underline;">Buy</a>
        {% endif %}
      </div>
    </li>
  {% empty %}
    <li>No materials listed for this project.</li>
  {% endfor %}
</ul>


        <a href="{% url 'project_index' %}" class="btn btn-primary mb-5">← Back to Projects</a>
    </div>
</div>


{% endblock content %}

