{% extends "base.html" %}

{% block page_title %}
<div class="text-center my-5">
  <h1 class="display-4 fw-bold" style="color: #73BDAB;">{{ project.title }}</h1>
</div>
{% endblock page_title %}

{% block content %}

<!-- Offcanvas Sidebar for Small Screens -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarMenu" aria-labelledby="sidebarMenuLabel">
  <div class="offcanvas-header" style="background-color:#CC6B49; color:#fff;">
    <h5 class="offcanvas-title" id="sidebarMenuLabel">Sidebar</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body" style="background-color: #F5F0E6;">
    {% include "projects/sidebar_content.html" %}
  </div>
</div>

<!-- Floating Button for Small Screens -->
<button class="btn btn-primary d-lg-none position-fixed bottom-0 end-0 m-3 shadow"
        type="button"
        data-bs-toggle="offcanvas"
        data-bs-target="#sidebarMenu"
        aria-controls="sidebarMenu"
        style="z-index: 1050;">
  ☰ Menu
</button>

<div class="row">
  <!-- Sidebar for Medium+ Screens -->
  <div class="col-md-3 mb-4 d-none d-lg-block">
    {% include "projects/sidebar_content.html" %}
  </div>

  <!-- Main Content -->
  <div class="col-12 col-lg-9">

    <div class="card shadow-sm border-0 mb-4">
      <img src="{% if project.cover %}{{ project.cover.url }}{% else %}/static/images/default_project.png{% endif %}"
           class="card-img-top"
           alt="{{ project.cover_alt|default:project.title }}"
           style="object-fit: cover; max-height: 600px;">
      <h1 class="project-title mx-3 mt-4 fs-3 fs-md-1">{{ project.title }}</h1>

      <div class="card-body">
        <small class="text-muted d-block mb-3">
          {{ project.created_at|date:"F j, Y" }} |
          {% if project.difficulty %}
            Difficulty:
            <span class="badge"
                  style="{% if project.difficulty == 'beginner' %}background-color: #73BDAB;
                         {% elif project.difficulty == 'intermediate' %}background-color: #CC6B49;
                         {% elif project.difficulty == 'advanced' %}background-color: #6F5643;
                         {% else %}background-color: #999;
                         {% endif %} color: #fff; font-weight: 600;">
              {{ project.get_difficulty_display }}
            </span>
          {% else %}
            <span class="badge" style="background-color: #999; color: #fff; font-weight: 600;">N/A</span>
          {% endif %}
        </small>

        <div class="card-text mt-3 post-body" style="color: #6F5643;">
          {{ project.body|safe }}
        </div>

        {% if project.tags.exists %}
        <div class="mt-4">
          <strong style="color: #6F5643;">Tags:</strong>
          {% for tag in project.tags.all %}
            <a href="{% url 'project_tag' tag.slug %}" class="text-decoration-none me-1">
              <span class="badge" style="color: white; background-color: #6F5643;">#{{ tag.name }}</span>
            </a>
          {% endfor %}
        </div>
        {% endif %}

        {% if project.related_items.exists %}
        <div class="mt-4">
          <h5>Related Posts & Tutorials:</h5>
          <ul class="list-group list-group-flush">
            {% for item in project.related_items.all %}
              <li class="list-group-item">
                <a href="{{ item.content_object.get_absolute_url }}">{{ item.content_object.title }}</a>
                <small class="text-muted">({{ item.content_type.model }})</small>
              </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </div>
    </div>

    <h2>Required Materials</h2>
    <ul style="list-style: none; padding: 0;">
      {% for entry_material in project.entrymaterial_set.all %}
        <li style="display: flex; align-items: center; margin-bottom: 12px;">
          {% if entry_material.material.icon %}
            <a href="{{ entry_material.material.url }}" target="_blank">
              <img src="{{ entry_material.material.icon.url }}" alt="{{ entry_material.material.name }}"
                   style="width:80px; height:80px; object-fit:contain; margin-right:10px;">
            </a>
          {% endif %}
          <div>
            <strong>{{ entry_material.material.name }}</strong>
            {% if entry_material.quantity %} - {{ entry_material.quantity }}{% endif %}
            {% if entry_material.notes %} ({{ entry_material.notes }}){% endif %}
            {% if entry_material.url %}
              <br>
            <a href="{{ entry_material.material.url }}" target="_blank" style="color:#007BFF; text-decoration:underline;">Buy</a>
            {% endif %}
          </div>
        </li>
      {% empty %}
        <li>No materials listed for this project.</li>
      {% endfor %}
    </ul>

    <a href="{% url 'project_index' %}" class="btn btn-primary mb-5">← Back to Projects</a>
  </div>
</div>

{% endblock content %}
