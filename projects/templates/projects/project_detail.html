{% extends "base.html" %}

{% block page_title %}
<div class="text-center my-5">
  <h1 class="display-4 fw-bold" style="color: #73BDAB;">{{ project.title }}</h1>
</div>
{% endblock page_title %}

{% block content %}

<!-- Offcanvas Sidebar for Small Screens -->
<div class="offcanvas offcanvas-start" style="border: 0 !important" tabindex="-1" id="sidebarMenu" aria-labelledby="sidebarMenuLabel">
 
    <nav class="navbar navbar-expand-lg">
  <div class="container">

    <a class="navbar-brand d-flex align-items-center" href="{% url 'home' %}" >
     
      <i class="bi bi-rocket fs-1 me-2" style="color: #73BDAB; transform: rotate(45deg); display: inline-block;"></i>

      <span style="color: #F0AD4E"><strong>ByteOverflow</strong></span>
    </a>

  <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>

 
</nav>
  {% comment %} <div class="offcanvas-header p-3" style="background-color: #2B2B2B; border-bottom: 2px solid #D2A24C;">
     <a class="navbar-brand d-flex align-items-center" href="{% url 'home' %}" >
   
      <i class="bi bi-rocket fs-1 me-2" style="color: #73BDAB; transform: rotate(45deg); display: inline-block;"></i>

      <span style="color: #F0AD4E"><strong>ByteOverflow</strong></span>
    </a>

    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div> {% endcomment %}
  <div class="offcanvas-body p-2" style="background-color: #F5F0E6;">
    {% include "projects/sidebar_content.html" %}
  </div>

</div>

<!-- Floating Button for Small Screens -->
<button class="btn btn-primary d-lg-none position-fixed bottom-0 end-0 m-3 shadow"
        type="button"
        data-bs-toggle="offcanvas"
        data-bs-target="#sidebarMenu"
        aria-controls="sidebarMenu"
        style="z-index: 1050;">
  ☰ Menu
</button>

<div class="row">
  <!-- Sidebar for Medium+ Screens -->
  <div class="col-md-3 mb-4 d-none d-lg-block">
    {% include "projects/sidebar_content.html" %}
  </div>

  <!-- Main Content -->
  <div class="col-12 col-lg-9">

    <div class="card shadow-sm border-0 mb-4">
      <img src="{% if project.cover %}{{ project.cover.url }}{% else %}/static/images/default_project.png{% endif %}"
           class="card-img-top"
           alt="{{ project.cover_alt|default:project.title }}"
           style="object-fit: cover; max-height: 600px;">
      <h1 class="project-title mx-3 mt-4 fs-3 fs-md-1">{{ project.title }}</h1>

      <div class="card-body">
        <small class="text-muted d-block mb-3">
          {{ project.created_at|date:"F j, Y" }} |
          {% if project.difficulty %}
            Difficulty:
            <span class="badge"
                  style="{% if project.difficulty == 'beginner' %}background-color: #73BDAB;
                         {% elif project.difficulty == 'intermediate' %}background-color: #CC6B49;
                         {% elif project.difficulty == 'advanced' %}background-color: #6F5643;
                         {% else %}background-color: #999;
                         {% endif %} color: #fff; font-weight: 600;">
              {{ project.get_difficulty_display }}
            </span>
          {% else %}
            <span class="badge" style="background-color: #999; color: #fff; font-weight: 600;">N/A</span>
          {% endif %}
        </small>

        <div class="card-text mt-3 post-body" style="color: #6F5643;">
          {{ project.body|safe }}
        </div>

        {% if project.tags.exists %}
        <div class="mt-4">
          <strong style="color: #6F5643;">Tags:</strong>
          {% for tag in project.tags.all %}
            <a href="{% url 'project_tag' tag.slug %}" class="text-decoration-none me-1">
              <span class="badge" style="color: white; background-color: #6F5643;">#{{ tag.name }}</span>
            </a>
          {% endfor %}
        </div>
        {% endif %}

        {% if project.related_items.exists %}
        <div class="mt-4">
          <h5>Related Posts & Tutorials:</h5>
          <ul class="list-group list-group-flush">
            {% for item in project.related_items.all %}
              <li class="list-group-item">
                <a href="{{ item.content_object.get_absolute_url }}">{{ item.content_object.title }}</a>
                <small class="text-muted">({{ item.content_type.model }})</small>
              </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </div>
    </div>
{% if project.links.exists %}
<div class="card shadow-sm border-0 mb-4">
  <div class="card-header" style="background-color:#CC6B49; color:#fff; font-weight:600;">
    Project Links
  </div>
  <div class="card-body">
    <ul class="list-group list-group-flush">
      {% for link in project.links.all %}
        <li class="list-group-item px-0">
          <strong>{{ link.get_link_type_display }}:</strong>
          <a href="{{ link.url }}" target="_blank" rel="noopener">{{ link.title }}</a>
        </li>
      {% empty %}
        <li class="list-group-item text-muted">No Project Links Yet.</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endif %}
{% if project.assets.exists %}
<div class="card shadow-sm border-0 mb-4">
  <div class="card-header" style="background-color:#6F5643; color:#fff; font-weight:600;">
    Assets
  </div>
  <div class="card-body">
    <ul class="list-group list-group-flush">
      {% for asset in project.assets.all %}
        <li class="list-group-item px-0">
          <strong>{{ asset.get_asset_type_display }}:</strong>
          <a href="{{ asset.file.url }}" target="_blank" rel="noopener">{{ asset.title }}</a>
          {% if asset.description %}
            <div class="small text-muted mt-1">{{ asset.description }}</div>
          {% endif %}
        </li>
      {% empty %}
        <li class="list-group-item text-muted">No Assets Yet.</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endif %}
{% if project.entrymaterial_set.exists %}
<div class="card shadow-sm border-0 mb-4">
  <div class="card-header" style="background-color:#948c3c; color:#fff; font-weight:600;">
    Required Materials
  </div>
  <div class="card-body">
    <ul class="list-unstyled mb-0">
      {% for entry_material in project.entrymaterial_set.all %}
        <li class="d-flex align-items-center mb-3">
          {% if entry_material.material.icon %}
            <a href="{{ entry_material.material.url }}" target="_blank">
              <img src="{{ entry_material.material.icon.url }}" alt="{{ entry_material.material.name }}"
                   style="width:80px; height:80px; object-fit:contain; margin-right:10px;">
            </a>
          {% endif %}
          <div>
            <strong>{{ entry_material.material.name }}</strong>
            {% if entry_material.quantity %} – {{ entry_material.quantity }}{% endif %}
            {% if entry_material.notes %} ({{ entry_material.notes }}){% endif %}
            {% if entry_material.url %}
              <br>
              <a href="{{ entry_material.material.url }}" target="_blank" style="color:#007BFF; text-decoration:underline;">Buy</a>
            {% endif %}
          </div>
        </li>
      {% endfor %}
    </ul>
  </div>
</div>
{% else %}
<div class="card shadow-sm border-0 mb-4">
  <div class="card-header" style="background-color:#73BDAB; color:#fff; font-weight:600;">
    Required Materials
  </div>
  <div class="card-body text-muted">
    No materials listed for this project.
  </div>
</div>
{% endif %}

    <a href="{% url 'project_index' %}" class="btn btn-primary mb-5">← Back to Projects</a>
  </div>
</div>

{% endblock content %}
